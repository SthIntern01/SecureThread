<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Assessment Report - {{ repository.name }}</title>
</head>
<body>
    <div class="cover-page">
        <!-- Blue wave header -->
        <div class="cover-wave-header"></div>
        
        <!-- White wave overlay -->
        <div class="cover-wave-overlay"></div>
        
        <!-- Bottom yellow bar -->
        <div class="cover-bottom-bar"></div>
        
        <!-- Main content - centered -->
        <div class="cover-content">
            <!-- Title -->
            <div class="cover-title">
                <h1>SECURETHREAD OPS VMS</h1>
                <h2>Vulnerability Report</h2>
            </div>
            
            <!-- Repository name -->
            <div class="cover-subtitle">
                <div class="repo-name">{{ repository. name }}</div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="cover-footer">
            <div class="footer-company">
                <div class="company-name">Sandboxsecurity. ai</div>
            </div>
        </div>
    </div>

    <!-- Table of Contents -->
    <div class="toc-page">
        <div class="toc-container">
            <h1 class="toc-title">Table of Contents</h1>
            
            <div class="toc-section">
                <div class="toc-section-title">Executive Overview</div>
                <div class="toc-item">
                    <div class="toc-item-content">
                        <span class="toc-item-number">1</span>
                        <span class="toc-item-title">Executive Summary</span>
                    </div>
                    <div class="toc-item-dots"></div>
                    <span class="toc-item-page">3</span>
                </div>
                <div class="toc-item">
                    <div class="toc-item-content">
                        <span class="toc-item-number">2</span>
                        <span class="toc-item-title">Assessment Methodology</span>
                    </div>
                    <div class="toc-item-dots"></div>
                    <span class="toc-item-page">4</span>
                </div>
            </div>
            
            <div class="toc-section">
                <div class="toc-section-title">Technical Analysis</div>
                <div class="toc-item">
                    <div class="toc-item-content">
                        <span class="toc-item-number">3</span>
                        <span class="toc-item-title">Security Findings Overview</span>
                    </div>
                    <div class="toc-item-dots"></div>
                    <span class="toc-item-page">5</span>
                </div>
                <div class="toc-item">
                    <div class="toc-item-content">
                        <span class="toc-item-number">4</span>
                        <span class="toc-item-title">Detailed Vulnerability Analysis</span>
                    </div>
                    <div class="toc-item-dots"></div>
                    <span class="toc-item-page">7</span>
                </div>
            </div>
            
            <div class="toc-section">
                <div class="toc-section-title">Risk & Business Impact</div>
                <div class="toc-item">
                    <div class="toc-item-content">
                        <span class="toc-item-number">5</span>
                        <span class="toc-item-title">Risk Assessment</span>
                    </div>
                    <div class="toc-item-dots"></div>
                    <span class="toc-item-page">{{ 10 + vulnerabilities|length }}</span>
                </div>
                <div class="toc-item">
                    <div class="toc-item-content">
                        <span class="toc-item-number">6</span>
                        <span class="toc-item-title">Business Impact Analysis</span>
                    </div>
                    <div class="toc-item-dots"></div>
                    <span class="toc-item-page">{{ 12 + vulnerabilities|length }}</span>
                </div>
            </div>
            
            <div class="toc-section">
                <div class="toc-section-title">Remediation</div>
                <div class="toc-item">
                    <div class="toc-item-content">
                        <span class="toc-item-number">7</span>
                        <span class="toc-item-title">Remediation Roadmap</span>
                    </div>
                    <div class="toc-item-dots"></div>
                    <span class="toc-item-page">{{ 15 + vulnerabilities|length }}</span>
                </div>
                <div class="toc-item">
                    <div class="toc-item-content">
                        <span class="toc-item-number">8</span>
                        <span class="toc-item-title">Implementation Guide</span>
                    </div>
                    <div class="toc-item-dots"></div>
                    <span class="toc-item-page">{{ 18 + vulnerabilities|length }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Executive Summary -->
    <div class="section-header page-break-before">
        <div class="section-number">Section 1</div>
        <h1 class="section-title">Executive Summary</h1>
        <p class="section-description">
            High-level overview of security assessment findings and business impact
        </p>
    </div>

    <div class="card card-primary">
        <h3>Assessment Overview</h3>
        <p>{{ metadata.company }} conducted a comprehensive security assessment of <strong>{{ repository.full_name }}</strong> 
           using advanced static analysis techniques. This assessment identified <strong>{{ security.total_vulnerabilities }}</strong> 
           security findings across <strong>{{ scan.files_scanned }}</strong> analyzed files with an overall risk classification of 
           <strong class="text-{{ security.risk_level|lower }}">{{ security.risk_level }}</strong>.</p>
        
        <div class="stats-grid mt-4">
            <div>
                <h4>Repository Profile</h4>
                <ul>
                    <li><strong>Primary Language:</strong> {{ repository.language or 'Mixed' }}</li>
                    <li><strong>Repository Type:</strong> {{ repository.visibility }}</li>
                    <li><strong>Source Platform:</strong> {{ repository.source|title }}</li>
                    <li><strong>Analysis Duration:</strong> {{ scan.duration or 'N/A' }}</li>
                </ul>
            </div>
            <div>
                <h4>Assessment Scope</h4>
                <ul>
                    <li><strong>Methodology:</strong> {{ scan.methodology }}</li>
                    <li><strong>Files Analyzed:</strong> {{ scan.files_scanned }}</li>
                    <li><strong>Scan Started:</strong> {{ scan.started_at|datetime_format('short') }}</li>
                    <li><strong>Scan Completed:</strong> {{ scan.completed_at|datetime_format('short') if scan.completed_at else 'In Progress' }}</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Key Findings Dashboard -->
    <div class="stats-grid-4">
        <div class="stat-card">
            <div class="stat-number stat-critical">{{ security.severity_counts.critical }}</div>
            <div class="stat-label">Critical Vulnerabilities</div>
            <div class="stat-change text-critical">{% if security.severity_counts.critical > 0 %}Immediate Action Required{% else %}None Found{% endif %}</div>
        </div>
        <div class="stat-card">
            <div class="stat-number stat-high">{{ security.severity_counts.high }}</div>
            <div class="stat-label">High Priority Issues</div>
            <div class="stat-change text-high">{{ security.severity_counts.critical + security.severity_counts.high }} Total Priority</div>
        </div>
        <div class="stat-card">
            <div class="stat-number stat-success">{{ "%.0f"|format(security.security_score) }}</div>
            <div class="stat-label">Security Score</div>
            <div class="stat-change text-success">Out of 100 points</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ security.threat_level }}</div>
            <div class="stat-label">Threat Level</div>
            <div class="stat-change">Overall Assessment</div>
        </div>
    </div>

    {% if security.severity_counts.critical > 0 %}
    <div class="alert alert-critical">
        <div class="alert-title">Critical Security Alert</div>
        <p><strong>{{ security.severity_counts.critical }}</strong> critical vulnerabilities require immediate attention. 
           These issues represent severe security risks that could lead to system compromise, data breaches, or 
           significant business impact.</p>
    </div>
    {% elif security.severity_counts.high > 0 %}
    <div class="alert alert-warning">
        <div class="alert-title">High Priority Security Issues</div>
        <p><strong>{{ security.severity_counts.high }}</strong> high-severity vulnerabilities should be addressed within 1-2 weeks 
           to maintain acceptable security posture.</p>
    </div>
    {% elif security.total_vulnerabilities > 0 %}
    <div class="alert alert-info">
        <div class="alert-title">Security Improvements Recommended</div>
        <p><strong>{{ security.total_vulnerabilities }}</strong> security findings identified. While not critical, 
           addressing these issues will improve overall security posture.</p>
    </div>
    {% else %}
    <div class="alert alert-success">
        <div class="alert-title">Excellent Security Posture</div>
        <p>No security vulnerabilities were identified during this comprehensive assessment. 
           This indicates strong security practices and mature development processes.</p>
    </div>
    {% endif %}

    <!-- Assessment Methodology -->
    <div class="section-header page-break-before">
        <div class="section-number">Section 2</div>
        <h1 class="section-title">Assessment Methodology</h1>
        <p class="section-description">
            Detailed overview of security assessment approach and technical methodology
        </p>
    </div>

    <div class="card">
        <h3>Technical Approach</h3>
        <p>This security assessment employed a comprehensive approach using {{ scan.methodology }} 
           with coverage across {{ scan.files_scanned }} files in the {{ repository.name }} repository.</p>
        
        <table class="data-table">
            <thead>
                <tr>
                    <th>Assessment Layer</th>
                    <th>Technique Used</th>
                    <th>Coverage</th>
                    <th>Results</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Static Code Analysis</strong></td>
                    <td>{{ scan.methodology }}</td>
                    <td>{{ scan.files_scanned }} files</td>
                    <td>{{ security.total_vulnerabilities }} findings</td>
                </tr>
                <tr>
                    <td><strong>Security Pattern Detection</strong></td>
                    <td>Rule-based analysis</td>
                    <td>{{ repository.language or 'Multi' }}-specific rules</td>
                    <td>{{ analysis.patterns|length }} patterns identified</td>
                </tr>
                <tr>
                    <td><strong>Compliance Mapping</strong></td>
                    <td>Framework alignment</td>
                    <td>OWASP, CWE standards</td>
                    <td>{{ "%.0f"|format(compliance.overall_compliance) }}% compliance</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="stats-grid">
        <div class="card">
            <h4>Standards & Frameworks Coverage</h4>
            <ul>
                <li><strong>OWASP Top 10:</strong> {% if compliance.owasp_mapping %}{{ compliance.owasp_mapping|length }} categories analyzed{% else %}Complete coverage{% endif %}</li>
                <li><strong>CWE Classification:</strong> {% if compliance.cwe_mapping %}{{ compliance.cwe_mapping|length }} weakness types{% else %}Comprehensive mapping{% endif %}</li>
                <li><strong>Security Score:</strong> {{ "%.0f"|format(security.security_score) }}/100</li>
                <li><strong>Risk Assessment:</strong> {{ security.risk_level }} level</li>
            </ul>
        </div>
        
        <div class="card">
            <h4>Repository Analysis Details</h4>
            <ul>
                <li><strong>Primary Language:</strong> {{ repository.language or 'Mixed Technologies' }}</li>
                <li><strong>Repository Source:</strong> {{ repository.source|title }}</li>
                <li><strong>Analysis Depth:</strong> Comprehensive</li>
                <li><strong>Scan Duration:</strong> {{ scan.duration or 'N/A' }}</li>
            </ul>
        </div>
    </div>

    <!-- Security Findings Overview -->
    <div class="section-header page-break-before">
        <div class="section-number">Section 3</div>
        <h1 class="section-title">Security Findings Overview</h1>
        <p class="section-description">
            Comprehensive analysis of identified security vulnerabilities and risk distribution
        </p>
    </div>

    <!-- Vulnerability Distribution -->
    <div class="card">
        <h3>Vulnerability Distribution Analysis</h3>
        {% if security.total_vulnerabilities > 0 %}
        <div class="stats-grid">
            <div>
                <h4>By Severity Level</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Severity</th>
                            <th>Count</th>
                            <th>Percentage</th>
                            <th>Risk Level</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="risk-critical">
                            <td><span class="badge badge-critical">Critical</span></td>
                            <td><strong>{{ security.severity_counts.critical }}</strong></td>
                            <td>{{ (security.severity_counts.critical / security.total_vulnerabilities * 100)|round(1) }}%</td>
                            <td>Extreme</td>
                        </tr>
                        <tr class="risk-high">
                            <td><span class="badge badge-high">High</span></td>
                            <td><strong>{{ security.severity_counts.high }}</strong></td>
                            <td>{{ (security.severity_counts.high / security.total_vulnerabilities * 100)|round(1) }}%</td>
                            <td>High</td>
                        </tr>
                        <tr class="risk-medium">
                            <td><span class="badge badge-medium">Medium</span></td>
                            <td><strong>{{ security.severity_counts.medium }}</strong></td>
                            <td>{{ (security.severity_counts.medium / security.total_vulnerabilities * 100)|round(1) }}%</td>
                            <td>Moderate</td>
                        </tr>
                        <tr class="risk-low">
                            <td><span class="badge badge-low">Low</span></td>
                            <td><strong>{{ security.severity_counts.low }}</strong></td>
                            <td>{{ (security.severity_counts.low / security.total_vulnerabilities * 100)|round(1) }}%</td>
                            <td>Low</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div>
                <h4>By Category</h4>
                {% if analysis.categories %}
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Count</th>
                            <th>Critical</th>
                            <th>High</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for category, stats in analysis.categories.items() %}
                        <tr>
                            <td><strong>{{ category }}</strong></td>
                            <td>{{ stats.count }}</td>
                            <td class="stat-critical">{{ stats.critical }}</td>
                            <td class="stat-high">{{ stats.high }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p>No categorized vulnerabilities found.</p>
                {% endif %}
            </div>
        </div>
        {% else %}
        <div class="alert alert-success">
            <div class="alert-title">No Security Vulnerabilities Detected</div>
            <p>The security assessment did not identify any vulnerabilities in the analyzed codebase. 
               This indicates excellent security practices.</p>
        </div>
        {% endif %}
    </div>

    <!-- Security Hotspots -->
    {% if analysis.hotspots and analysis.hotspots|length > 0 %}
    <div class="card card-warning">
        <h3>Security Hotspots</h3>
        <p>Files with multiple vulnerabilities requiring priority attention:</p>
        
        {% for hotspot in analysis.hotspots %}
        <div class="vulnerability-card high page-break-avoid">
            <div class="vulnerability-header">
                <div>
                    <div class="vulnerability-id">HOTSPOT-{{ loop.index }}</div>
                    <div class="vulnerability-title">{{ hotspot.file }}</div>
                    <div class="vulnerability-meta">
                        {{ hotspot.vulnerability_count }} vulnerabilities | Risk: {{ hotspot.risk_level }}
                    </div>
                </div>
                <span class="badge badge-high">{{ hotspot.risk_level }}</span>
            </div>
            <p><strong>Recommendation:</strong> {{ hotspot.recommendation }}</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Detailed Vulnerability Analysis -->
    <div class="section-header page-break-before">
        <div class="section-number">Section 4</div>
        <h1 class="section-title">Detailed Vulnerability Analysis</h1>
        <p class="section-description">
            Comprehensive technical analysis of each identified security vulnerability
        </p>
    </div>

    {% if vulnerabilities and vulnerabilities|length > 0 %}
    {% for vuln in vulnerabilities %}
    <div class="vulnerability-card {{ vuln.severity }} page-break-avoid">
        <div class="vulnerability-header">
            <div>
                <div class="vulnerability-id">VULN-{{ "%03d"|format(vuln.index) }}</div>
                <div class="vulnerability-title">{{ vuln.title }}</div>
                <div class="vulnerability-meta">
                    üìÅ {{ vuln.file_path }}{% if vuln.line_number %} : Line {{ vuln.line_number }}{% endif %} ‚Ä¢ 
                    Category: {{ vuln.category }} ‚Ä¢ 
                    {% if vuln.cwe_id %}CWE: {{ vuln.cwe_id }} ‚Ä¢ {% endif %}
                    Risk Score: {{ "%.1f"|format(vuln.risk_score) }}/10
                </div>
            </div>
            <div>
                <span class="badge badge-{{ vuln.severity }}">{{ vuln.severity|upper }}</span>
                {% if vuln.owasp_category %}
                <span class="badge badge-info">{{ vuln.owasp_category }}</span>
                {% endif %}
            </div>
        </div>
        
        <div class="vulnerability-description">
            <h5>Technical Description</h5>
            <p>{{ vuln.description }}</p>
        </div>
        
        {% if vuln.code_snippet %}
        <h5>Vulnerable Code</h5>
        <div class="code-block">{{ vuln.code_snippet }}</div>
        {% endif %}
        
        <div class="stats-grid" style="margin: 16px 0; font-size: 11px;">
            <div>
                <strong>Business Impact:</strong> {{ vuln.business_impact }}<br>
                <strong>Exploitability:</strong> {{ vuln.exploitability }}<br>
            </div>
            <div>
                <strong>Remediation Effort:</strong> {{ vuln.remediation_effort }}<br>
                <strong>Priority Score:</strong> {{ "%.1f"|format(vuln.priority_score) }}/10<br>
            </div>
        </div>
        
        <div class="vulnerability-recommendation">
            <div class="recommendation-title">Remediation Guidance</div>
            <p><strong>Recommendation:</strong> {{ vuln.recommendation }}</p>
            {% if vuln.fix_suggestion %}
            <p><strong>Implementation:</strong> {{ vuln.fix_suggestion }}</p>
            {% endif %}
        </div>
        
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #E5E7EB; font-size: 10px; color: #6B7280;">
            <strong>Detected:</strong> {{ vuln.detected_at|datetime_format }} | 
            <strong>Impact:</strong> {{ vuln.impact }} | 
            <strong>OWASP:</strong> {{ vuln.owasp_category or 'Not Classified' }}
        </div>
    </div>
    {% endfor %}
    
    {% else %}
    <div class="alert alert-success">
        <div class="alert-title">Excellent Security Posture</div>
        <p>No security vulnerabilities were identified during this comprehensive assessment. 
           This indicates strong security practices and mature development processes.</p>
    </div>
    {% endif %}

    <!-- Risk Assessment -->
    <div class="section-header page-break-before">
        <div class="section-number">Section 5</div>
        <h1 class="section-title">Risk Assessment</h1>
        <p class="section-description">
            Comprehensive risk analysis and potential business impact
        </p>
    </div>

    <!-- Risk Matrix -->
    <div class="card">
        <h3>Enterprise Risk Matrix</h3>
        <table class="risk-matrix">
            <thead>
                <tr>
                    <th>Severity Level</th>
                    <th>Count</th>
                    <th>Business Impact</th>
                    <th>Timeline</th>
                    <th>Estimated Cost Impact</th>
                </tr>
            </thead>
            <tbody>
                <tr class="risk-critical">
                    <td><span class="badge badge-critical">Critical</span></td>
                    <td><strong>{{ security.severity_counts.critical }}</strong></td>
                    <td>System compromise, data breach, regulatory fines</td>
                    <td>24-48 hours</td>
                    <td>{{ (security.severity_counts.critical * 50000)|currency }}</td>
                </tr>
                <tr class="risk-high">
                    <td><span class="badge badge-high">High</span></td>
                    <td><strong>{{ security.severity_counts.high }}</strong></td>
                    <td>Significant security gaps, potential data exposure</td>
                    <td>1-2 weeks</td>
                    <td>{{ (security.severity_counts.high * 25000)|currency }}</td>
                </tr>
                <tr class="risk-medium">
                    <td><span class="badge badge-medium">Medium</span></td>
                    <td><strong>{{ security.severity_counts.medium }}</strong></td>
                    <td>Moderate security concerns, limited exposure</td>
                    <td>1 month</td>
                    <td>{{ (security.severity_counts.medium * 10000)|currency }}</td>
                </tr>
                <tr class="risk-low">
                    <td><span class="badge badge-low">Low</span></td>
                    <td><strong>{{ security.severity_counts.low }}</strong></td>
                    <td>Minor security issues, best practice gaps</td>
                    <td>Next quarter</td>
                    <td>{{ (security.severity_counts.low * 2500)|currency }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Attack Vector Analysis -->
    {% if analysis.attack_vectors and analysis.attack_vectors|length > 0 %}
    <div class="card card-warning">
        <h3>Primary Attack Vectors</h3>
        <div class="stats-grid">
            {% for vector in analysis.attack_vectors %}
            <div class="alert alert-{{ vector.risk|lower }}">
                <div class="alert-title">{{ vector.vector }}</div>
                <p>{{ vector.description }}</p>
                <p><strong>Occurrences:</strong> {{ vector.count }} | <strong>Risk Level:</strong> {{ vector.risk }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Business Impact Analysis -->
    <div class="section-header page-break-before">
        <div class="section-number">Section 6</div>
        <h1 class="section-title">Business Impact Analysis</h1>
        <p class="section-description">
            Financial and operational impact assessment of identified security risks
        </p>
    </div>

    <div class="stats-grid">
        <div class="card card-danger">
            <h4>Potential Risk Exposure</h4>
            <div class="stat-number text-critical">{{ business.potential_cost|currency }}</div>
            <p>Total potential cost of security incidents if vulnerabilities are exploited</p>
            
            <div class="mt-4">
                <h5>Risk Breakdown:</h5>
                <ul>
                    <li>Critical vulnerabilities: {{ (security.severity_counts.critical * 50000)|currency }}</li>
                    <li>High severity issues: {{ (security.severity_counts.high * 25000)|currency }}</li>
                    <li>Medium severity concerns: {{ (security.severity_counts.medium * 10000)|currency }}</li>
                    <li>Low severity items: {{ (security.severity_counts.low * 2500)|currency }}</li>
                </ul>
            </div>
        </div>

        <div class="card card-success">
            <h4>Investment Requirements</h4>
            <div class="stat-number text-success">{{ business.remediation_cost|currency }}</div>
            <p>Estimated investment required to address all identified security issues</p>
            
            <div class="mt-4">
                <h5>Investment Breakdown:</h5>
                <ul>
                    <li>Development resources: {{ (business.remediation_cost * 0.6)|currency }}</li>
                    <li>Security tools & infrastructure: {{ (business.remediation_cost * 0.2)|currency }}</li>
                    <li>Training & process improvement: {{ (business.remediation_cost * 0.15)|currency }}</li>
                    <li>External consulting: {{ (business.remediation_cost * 0.05)|currency }}</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ROI Analysis -->
    <div class="card card-primary">
        <h3>Return on Investment Analysis</h3>
        <div class="stats-grid-4">
            <div class="stat-card">
                <div class="stat-number stat-success">{{ business.cost_avoidance|currency }}</div>
                <div class="stat-label">Cost Avoidance</div>
                <div class="stat-change">Potential losses prevented</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-success">{{ "%.0f"|format(business.roi_percentage) }}%</div>
                <div class="stat-label">ROI Percentage</div>
                <div class="stat-change">Return on security investment</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-success">{{ "%.1f"|format(business.payback_period_months) }}</div>
                <div class="stat-label">Payback Period</div>
                <div class="stat-change">Months to break even</div>
            </div>
            <div class="stat-card">
                <div class="stat-number stat-success">{{ resources.timeline_weeks|round|int }}</div>
                <div class="stat-label">Implementation</div>
                <div class="stat-change">Weeks to complete</div>
            </div>
        </div>
    </div>

    <!-- Compliance Analysis -->
    {% if compliance.owasp_mapping and compliance.owasp_mapping|length > 0 %}
    <div class="card">
        <h3>OWASP Top 10 Compliance Status</h3>
        <table class="data-table">
            <thead>
                <tr>
                    <th>OWASP Category</th>
                    <th>Vulnerabilities</th>
                    <th>Risk Distribution</th>
                    <th>Compliance Status</th>
                </tr>
            </thead>
            <tbody>
                {% for owasp_cat, stats in compliance.owasp_mapping.items() %}
                <tr>
                    <td><strong>{{ owasp_cat }}</strong></td>
                    <td>{{ stats.count }}</td>
                    <td>
                        {% if stats.critical > 0 %}<span class="badge badge-critical">{{ stats.critical }}</span>{% endif %}
                        {% if stats.high > 0 %}<span class="badge badge-high">{{ stats.high }}</span>{% endif %}
                        {% if stats.medium > 0 %}<span class="badge badge-medium">{{ stats.medium }}</span>{% endif %}
                        {% if stats.low > 0 %}<span class="badge badge-low">{{ stats.low }}</span>{% endif %}
                    </td>
                    <td>
                        {% if stats.count == 0 %}
                        <span class="badge badge-success">Compliant</span>
                        {% elif stats.critical > 0 or stats.high > 0 %}
                        <span class="badge badge-critical">Non-Compliant</span>
                        {% else %}
                        <span class="badge badge-medium">Partial</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- Remediation Roadmap -->
    <div class="section-header page-break-before">
        <div class="section-number">Section 7</div>
        <h1 class="section-title">Remediation Roadmap</h1>
        <p class="section-description">
            Comprehensive implementation plan with phases, timelines, and resource requirements
        </p>
    </div>

    <!-- Implementation Phases -->
    {% for phase_key, phase in recommendations.implementation_roadmap.items() %}
    <div class="card page-break-avoid">
        <div class="section-header">
            <h3>{{ phase.name }} ({{ phase.duration }})</h3>
        </div>
        
        <div class="recommendation-section">
            <div class="recommendation-header">
                <div class="recommendation-icon">{{ loop.index }}</div>
                <div class="recommendation-title">Phase {{ loop.index }} Implementation Plan</div>
            </div>
            
            {% for action in phase.actions %}
            <div class="recommendation-item">
                <div class="recommendation-priority priority-{{ action.priority|lower }}">{{ action.priority }}</div>
                <h5>{{ action.action }}</h5>
                
                <div class="stats-grid" style="margin: 12px 0; font-size: 11px;">
                    <div>
                        <strong>Timeline:</strong> {{ action.timeline }}<br>
                        <strong>Effort Level:</strong> {{ action.effort }}<br>
                    </div>
                    <div>
                        <strong>Estimated Cost:</strong> {{ action.cost }}<br>
                        <strong>Resources:</strong> {{ action.resources }}<br>
                    </div>
                </div>
                
                <p><strong>Expected Impact:</strong> {{ action.impact }}</p>
            </div>
            {% endfor %}
        </div>
        
        <div class="alert alert-info">
            <div class="alert-title">Phase {{ loop.index }} Success Metrics</div>
            <ul>
                {% for metric in phase.success_metrics %}
                <li>{{ metric }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endfor %}

    <!-- Implementation Guide -->
    <div class="section-header page-break-before">
        <div class="section-number">Section 8</div>
        <h1 class="section-title">Implementation Guide</h1>
        <p class="section-description">
            Technical guidance and best practices for remediation implementation
        </p>
    </div>

    <!-- Resource Planning -->
    <div class="card">
        <h3>Resource Planning & Allocation</h3>
        
        <div class="stats-grid-4">
            <div class="stat-card">
                <div class="stat-number">{{ resources.developer_days|round|int }}</div>
                <div class="stat-label">Developer Days</div>
                <div class="stat-change">Total effort required</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ resources.security_specialist_days|round|int }}</div>
                <div class="stat-label">Security Specialist Days</div>
                <div class="stat-change">Expert guidance needed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ resources.timeline_weeks|round|int }}</div>
                <div class="stat-label">Timeline (Weeks)</div>
                <div class="stat-change">Expected completion</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ resources.estimated_cost|currency }}</div>
                <div class="stat-label">Total Investment</div>
                <div class="stat-change">Budget requirement</div>
            </div>
        </div>
    </div>

    <!-- Quick Wins Analysis -->
    {% if recommendations.quick_wins and recommendations.quick_wins|length > 0 %}
    <div class="card card-success">
        <h3>Quick Wins - Immediate Impact Opportunities</h3>
        <p>Low-effort, high-impact security improvements that can be implemented immediately:</p>
        
        {% for win in recommendations.quick_wins %}
        <div class="alert alert-success">
            <div class="alert-title">{{ win.title }}</div>
            <div class="stats-grid" style="font-size: 11px;">
                <div>
                    <strong>Issues Addressed:</strong> {{ win.count }}<br>
                    <strong>Implementation Effort:</strong> {{ win.effort }}
                </div>
                <div>
                    <strong>Expected Impact:</strong> {{ win.impact }}<br>
                    <strong>Timeline:</strong> {{ win.timeline }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Strategic Initiatives -->
    <div class="card">
        <h3>Strategic Security Program Initiatives</h3>
        {% for initiative in recommendations.strategic_initiatives %}
        <div class="recommendation-item page-break-avoid">
            <div class="recommendation-priority priority-strategic">STRATEGIC</div>
            <h4>{{ initiative.initiative }}</h4>
            <p>{{ initiative.description }}</p>
            
            <div class="stats-grid" style="margin: 16px 0;">
                <div>
                    <h5>Implementation Details</h5>
                    <ul>
                        <li><strong>Timeline:</strong> {{ initiative.timeline }}</li>
                        <li><strong>Investment Required:</strong> {{ initiative.investment }}</li>
                        <li><strong>Expected ROI:</strong> {{ initiative.roi }}</li>
                    </ul>
                </div>
                <div>
                    <h5>Strategic Benefits</h5>
                    <ul>
                        <li>Reduced security incident frequency</li>
                        <li>Improved compliance posture</li>
                        <li>Enhanced development velocity</li>
                        <li>Stronger security culture</li>
                    </ul>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Executive Recommendations -->
    <div class="alert alert-info page-break-avoid">
        <div class="alert-title">Executive Recommendations</div>
        <ol>
            {% if security.severity_counts.critical > 0 %}
            <li><strong>Immediate Crisis Response:</strong> Establish emergency security task force to address {{ security.severity_counts.critical }} critical vulnerabilities within 48 hours.</li>
            {% endif %}
            {% if business.remediation_cost > 0 %}
            <li><strong>Security Investment Approval:</strong> Approve {{ business.remediation_cost|currency }} security investment to achieve {{ "%.0f"|format(business.roi_percentage) }}% ROI.</li>
            {% endif %}
            <li><strong>Governance Enhancement:</strong> Implement security governance framework with regular executive reporting.</li>
            <li><strong>Strategic Security Program:</strong> Launch comprehensive DevSecOps initiative to prevent future security debt.</li>
            {% if compliance.overall_compliance < 90 %}
            <li><strong>Compliance Alignment:</strong> Prioritize compliance gaps to reduce regulatory risk exposure.</li>
            {% endif %}
        </ol>
    </div>

    <!-- Report Footer -->
    <div class="report-footer">
        <div class="footer-logo">üõ°Ô∏è</div>
        <div class="footer-company">{{ metadata.company }}</div>
        <div class="footer-tagline">{{ metadata.tagline }}</div>
        <div style="margin: 20px 0;">
            <strong>Report Generated:</strong> {{ metadata.generated_at|datetime_format }} <br>
            <strong>Assessment Team:</strong> {{ metadata.analyst.name }}, {{ metadata.analyst.title }} <br>
            <strong>Contact:</strong> {{ metadata.analyst.email }} <br>
            <strong>Organization:</strong> {{ metadata.analyst.organization }}
        </div>
        <div class="footer-confidential">{{ metadata.classification }} - Handle with Appropriate Care</div>
        <div style="font-size: 9px; color: #6B7280; margin-top: 12px;">
            This report contains proprietary and confidential information. Distribution is restricted to authorized personnel only.
        </div>
    </div>
</body>
</html>